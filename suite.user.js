/*!
// ==UserScript==
// @name         Backpack.tf Enhancement Suite
// @namespace    http://steamcommunity.com/id/theoddball
// @author       The Oddball
// @version      1.6.9
// @description  Enhances your backpack.tf experience.
// @include      /^https?://.*\.?backpack\.tf/.*$/
// @exclude      /^https?://forums\.backpack\.tf/.*$/
// @require      https://caresx.github.io/backpacktf-enhancement-suite/deps.js
// @downloadURL  https://theoddball.github.io/oddBES/suite.user.js
// @updateURL    https://theoddball.github.io/oddBES/suite.meta.js
// @grant        GM_xmlhttpRequest
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// ==/UserScript==
*/

!function e(t,a,n){function i(r,s){if(!a[r]){if(!t[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=a[r]={exports:{}};t[r][0].call(u.exports,function(e){var a=t[r][1][e];return i(a||e)},u,u.exports,e,t,a,n)}return a[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}({1:[function(e,t,a){function n(e){e(),e.initialized=!0}var i=e("./preferences"),o=e("./page");document.getElementById("helpers")&&(o.init(),e("./api").init(),i.defaults({lotto:{show:!0},notifications:{updatecount:"click"},pricetags:{modmult:.5,tooltips:!0},changes:{enabled:!0,outdatedwarn:!0,period:864e5},pricing:{step:EconCC.Disabled,range:EconCC.Range.Mid},classifieds:{signature:"","signature-buy":"",autoclose:!0,autopeek:!1,autofill:"default"},homebg:{image:"",repeat:"no-repeat",posy:"top",posx:"center",attachment:"fixed",sizing:"cover",replacewalls:!0},other:{originalkeys:!1,thirdpartyprices:!0}}),n(e("./components/improvements")),n(e("./components/reptf")),n(e("./components/quicklist")),n(e("./components/pricetags")),i.enabled("changes")&&n(e("./components/changes")),n(e("./components/refresh")),n(e("./components/classifieds")),n(e("./components/prefs")),n(e("./components/search")),n(e("./components/dupes")),n(e("./components/users")),e("./menu-actions").applyActions(),o.addTooltips(),$(document).off("click.bs.button.data-api"),o.loaded=!0)},{"./api":2,"./components/changes":5,"./components/classifieds":6,"./components/dupes":7,"./components/improvements":8,"./components/prefs":9,"./components/pricetags":10,"./components/quicklist":11,"./components/refresh":12,"./components/reptf":13,"./components/search":14,"./components/users":18,"./menu-actions":22,"./page":23,"./preferences":24}],2:[function(e,t,a){function n(e,t,a){function n(){o.enqueue(e,t,a),o.done()}var i,s,c,l,u="I"!==e.name[0]?"I"+e.name:e.name,p="string"==typeof e.version?e.version:"v"+e.version,f="/api/"+u+"/"+p+"/",h={key:r.key,appid:e.appid||440,compress:1};a=a||{};for(l in a)h[l]=a[l];if(e.cache&&(s=f+"--"+JSON.stringify(h),i=d.get(s),i.value)){if(i.value.success)return t(i.value),void o.done();d.rm(s).save()}$.ajax({method:"GET",url:f,data:h,cache:!1,dataType:"json"}).then(function(a){if(!a.response.success){if(e._fail)return;return console.error("API error :: "+u+": "+JSON.stringify(a)),void("API key does not exist."===a.message||"This API key is not valid."===a.message?(r.remove(),n(),r.load()):/^You can only request this page every/.test(a.message)?(c=1e3*a.message.match(/\d/g)[1],setTimeout(n,c+100+Math.round(1e3*Math.random()))):setTimeout(function(){e._fail=!0,n()},1e3))}e.cache&&d.timeout(e.cache||6e4).set(s,a.response).save(),t(a.response),o.done()})}function i(){o.enqueue.apply(o,arguments)}var o,r,s=e("./page"),c=e("./helpers/apikey"),l=e("./helpers/queue"),u=e("./cache"),d=new u("bes-cache-api");a.init=function(){o=new l,o.exec=n.bind(o),o.canProceed=function(){return!!r.key}.bind(o),r=new c("backpackapikey",{url:"https://backpack.tf/api/register"},o.next.bind(o)),r.extract=function(e){return(e.match(/<pre>([a-f\d]{24})<\/pre>/)||[])[1]}.bind(r),r.register=function(){var e=s.csrfToken(),t=this;e&&$.ajax({method:"POST",url:"/api/register",data:{url:"backpack.tf",comments:"backpack.tf Enhancement Suite","user-id":e},dataType:"text"}).then(function(e){t.set(t.extract(e))})}.bind(r),r.load()},a.interface=a.I=a.call=i,a.IGetPrices=function(e,t){return i({name:"IGetPrices",version:4,cache:18e5},e,t)},a.IGetCurrencies=function(e,t){return i({name:"IGetCurrencies",version:1,cache:864e5},e,t)},a.IGetSpecialItems=function(e,t){return i({name:"IGetSpecialItems",version:1,cache:864e5},e,t)},a.IGetUsers=function(e,t,a){return a=a||{},a.ids=Array.isArray(e)?e.join(","):e,i({name:"IGetUsers",version:2},t,a)},a.IGetUserListings=function(e,t,a){return a=a||{},a.steamid=e,i({name:"IGetUserListings",version:2},t,a)}},{"./cache":3,"./helpers/apikey":20,"./helpers/queue":21,"./page":23}],3:[function(e,t,a){function n(e,t){this.name=e,this.storage=JSON.parse(i.getItem(e)||"{}"),this.pruneTime="number"==typeof t?t:1e3,o.push(e)}var i=e("./datastore"),o=[];n.prototype.get=function(e){var t=this.prune();return this.storage[e]?(t&&this.save(),{value:this.storage[e].json}):{update:!0}},n.prototype.set=function(e,t){return this.storage[e]={time:Date.now()+this.pruneTime,json:t},this},n.prototype.rm=function(e){return delete this.storage[e],this},n.prototype.save=function(){return i.setItem(this.name,JSON.stringify(this.storage)),this},n.prototype.timeout=function(e){return this.pruneTime=e,this},n.prototype.prune=function(){var e,t,a=!1;if(this.pruneTime<=0)return a;for(t in this.storage)e=this.storage[t].time,Date.now()>e&&(a=!0,delete this.storage[t]);return a},t.exports=n,t.exports.names=o},{"./datastore":19}],4:[function(e,t,a){function n(e){var t,a;for(t in d)if(a=d[t],a.sym===e)return t}function i(e){return(e.match(/(?:\$|€|£| pуб\.)/)||[])[0]||""}function o(e){this.base=e.base,this.rates=e.rates,this.rates[this.base]=1}function r(e){u.GET("http://api.fixer.io/latest?base=USD&symbols=EUR,RUB,GBP",function(t){var a;try{a=JSON.parse(t)}catch(e){return}s.set("rates",a).save(),e(c=new o(a))})}var s,c,l=e("../cache"),u=e("../script"),d={USD:{sym:"$",thousand:",",decimal:"."},EUR:{sym:"€",thousand:" ",decimal:",",trail:!0},RUB:{sym:" pуб.",thousand:"",decimal:",",trail:!0},GBP:{sym:"£",thousand:",",decimal:"."}};o.prototype.convert=function(e,t,a){return this.rates.hasOwnProperty(t)&&this.rates.hasOwnProperty(a)?t===a?e:t!==this.base?1*e/this.rates[t]:e*this.rates[a]:-1},o.prototype.convertFromBase=function(e,t){return this.convert(e,this.base,t)},o.prototype.convertToBase=function(e,t){return this.convert(e,t,this.base)},o.prototype.parse=function(e){var t=i(e),a=n(t),o=d[a]||{};return{val:parseFloat(e.replace(new RegExp(o.thousand,"g"),"").replace(o.decimal,".").replace(/[^\d|\.]+/g,"").trim()),sym:t,alpha:a,trailing:o.trail||!1,matched:""!==t}},a.init=function(e){s=new l("bes-cache-cc",864e5);var t=s.get("rates");if(c)return e(c);t.update?r(e):e(c=new o(t.value))}},{"../cache":3,"../script":26}],5:[function(e,t,a){function n(e){var t=moment.unix(e.last_update);return v.diff(t)<=g}function i(e){return v.diff(moment.unix(e.last_update),"months",!0)>=3}function o(e){function t(e){p.addItemIcon(e,d)}var a,n,i,o,r,s,c,l,d,f=EconCC.Mode.Label;for(a in e)n=e[a],i=n.price,o=n.elements,r=n.hasOwnProperty("outdated"),d="",!1!==n.change&&(s={low:Math.abs(i.difference),currency:"metal"},0===i.last_update?(l="fa fa-certificate",c="Newly priced"):0===i.difference?(l="fa fa-yellow fa-retweet",c="Refreshed"):i.difference>0?(l="fa fa-green fa-arrow-up",c="Up "+u.format(s,f)):i.difference<0&&(l="fa fa-red fa-arrow-down",c="Down "+u.format(s,f)),c+=" "+moment.unix(i.last_update).from(v),d+="<div class='arrow-icon changes-price-arrow'><i class='"+l+" change-tooltip' title='"+c+"'></i></div>"),r&&(d+="<div class='arrow-icon'><i class='fa fa-warning fa-red od-tooltip' title='Last updated "+moment.unix(i.last_update).from(v)+"'></i></div>"),d.length&&o.forEach(t);p.addTooltips($(".change-tooltip, .od-tooltip"))}function r(e){var t=$(".item:not(.spacer)"),a=d.pref("changes","outdatedwarn"),r={},s={};t.each(function(){var t,o,c,l=e.items[this.dataset.name],u=+this.dataset.quality,d="1"===this.dataset.tradable,p="1"===this.dataset.craftable,f=this.dataset.crate||this.dataset.priceindex;if(l){if(o=this.dataset.defindex+"-"+u+"-"+d+"-"+p+(f?"-"+f:""),!0===r[o])return void s[o].elements.push(this);if(!1!==r[o]&&(t=l.prices[u])&&(t=t[d?"Tradable":"Non-Tradable"])&&(t=t[p?"Craftable":"Non-Craftable"]))if(f){if(!(t=t[f]))return;c=a&&5===u&&i(t),n(t)?(r[o]=!0,s[o]={price:t,elements:[this]},c&&(s[o].outdated=!0)):(c&&(s[o]={price:t,elements:[this],change:!1,outdated:!0}),r[o]=c)}else t=t[0],n(t)?(r[o]=!0,s[o]={price:t,elements:[this]}):r[o]=!1}}),o(s)}function s(){var e,t,a,n={},i=g/1e3/60/60,o=[],r=$("<div>");a=$(".changes-price-arrow").parent().parent().filter(function(){var e=this.dataset.defindex;return!n.hasOwnProperty(e)&&(n[e]=!0)}).clone().addClass("change-clone").removeClass("unselected"),i>=24&&(e=Math.floor(i/24),o.push((1===e?"":e+" ")+"day"+(1===e?"":"s")),i%=24),i&&o.push((1===i?"":i+" ")+"hour"+(1===i?"":"s")),r.append("<p><i>Showing price changes from the past "+o.join(" and ")+"</i></p>").append($("<div id='change-cloned' class='row'/>").append(a)),p.modal("Recent Price Changes",r),t=$(".change-clone"),p.addItemPopovers(t,$("#change-cloned")),p.addTooltips(t.find(".change-tooltip"),"#change-cloned")}function c(){m.addAction({name:"Recent Price Changes",icon:"fa-calendar",id:"bp-recent-changes",click:s})}function l(){p.isBackpack()&&440===p.appid()&&h.IGetPrices(function(e){f.shared(function(t){u=t,c(),r(e)})})}var u,d=e("../preferences"),p=e("../page"),f=e("../pricing"),h=e("../api"),m=e("../menu-actions"),g=d.pref("changes","period"),v=moment();t.exports=l},{"../api":2,"../menu-actions":22,"../page":23,"../preferences":24,"../pricing":25}],6:[function(e,t,a){function n(){f.addAction({name:"Remove Listings",icon:"fa-trash-o",id:"rm-classifieds-listings",click:function(){u.exec("$('.listing-remove').click().click();"),function e(){setTimeout(function(){$(".listing-remove").length?e():location.reload()},300)}()}})}function i(e){var t=d.pref("classifieds",e),a=$("#details");$("#page-content .row:eq(1)").before('<div class="row"><div class="col-md-12 "><div class="panel panel-main" id="peek-panel"><div class="panel-heading">Classifieds <span class="pull-right"><small><a href="#" id="classifieds-peek">Peek</a></small></span></div></div></div></div></div>'),a.val().length||(a.val(t),u.exec('$("#details").trigger("blur");')),d.pref("classifieds","autopeek")?peek():$("#classifieds-peek").one("click",peek),d.pref("classifieds","autoclose")&&$("#classifieds-form").submit(function(){return $.post(location.pathname,$(this).serialize()).done(function(){window.close()}).fail(function(){alert("Error occurred, try again later."),$("#button_save").prop("disabled",!0).html("Create Listing")}),!1})}function o(){var e=$("#metal"),t=$("#keys"),a=$(".item-singular .item"),n=parseFloat(a.data("price"));"backpack"===d.pref("classifieds","autofill")&&n&&(e.val().length||t.val().length||p.shared(function(a){var i={value:n,currency:"metal"},o=a.convertToCurrency(i,"keys");o.value>=1&&(i=a.convertToCurrency({value:o.value%1,currency:"keys"},"metal"),o.value=Math.floor(o.value),t.val(parseInt(a.formatCurrency(o),10))),i.value>.08&&a.scope({step:EconCC.Enabled,currencies:{metal:{step:.11}}},function(){e.val(parseFloat(a.formatCurrency(i)))}),u.window.updateFormState()}))}function r(){i("signature-buy")}function s(){i("signature"),o()}function c(){document.querySelector(".listing-remove")&&n()}function l(){var e=location.pathname;/^\/classifieds\/buy\/.{1,}\/.{1,}\/.{1,}\/.{1,}\/?.*/.test(e)?r():/^\/classifieds\/relist\/.{1,}/.test(e)?r():/^\/classifieds\/sell\/.{1,}/.test(e)&&s(),c()}var u=(e("../page"),e("../script")),d=e("../preferences"),p=e("../pricing"),f=e("../menu-actions");e("./pricetags");t.exports=l},{"../menu-actions":22,"../page":23,"../preferences":24,"../pricing":25,"../script":26,"./pricetags":10}],7:[function(e,t,a){function n(){function e(e,t){e.removeClass("btn-default").addClass(t?"btn-danger":"btn-success")}function t(e,t){$.get("/item/"+e,function(a){var n=/Refer to entries in the item history <strong>where the item ID is not chronological/.test(a);window.dupeCache[e]=n,window.addDupeWarn(t,n)})}function a(e){var t=window.dupe_createDetails(e),a=e.attr("data-original-id"),n=t.find(".fa-calendar-o").parent();return null!=window.dupeCache[a]?window.addDupeWarn(n,window.dupeCache[a]):n.mouseover(function(){null!==window.dupeCache[a]&&(window.dupeCache[a]=null,setTimeout(function(){window.checkDuped(a,n)},80))}),t}s.exec("var dupe_createDetails = window.createDetails, dupeCache = {};window.checkDuped = "+t+";window.addDupeWarn = "+e+";window.createDetails = "+a+";")}function i(){var e=[];if($(".item:not(.spacer,.unselected):visible").each(function(){var t=$(this),a=c.addItemIcon(t);a.find(".dupe-check-result").length||(a.append('<div class="arrow-icon"><i class="fa fa-spin fa-spinner dupe-check-result"></i></div>'),e.push(t))}),!e.length)return alert("No unchecked items in this selection");!function t(){function a(e){n.removeClass("fa-spinner fa-spin"),e?n.addClass("fa-exclamation-circle").css("color","red"):n.addClass("fa-check-circle").css("color","green"),t()}var n,i,o,r=e.shift();if(r){if(i=r.attr("data-original-id"),n=r.find(".dupe-check-result"),o=s.window.dupeCache,o.hasOwnProperty(i))return a(o[i]);$.get("/item/"+i,function(e){var t=/Refer to entries in the item history <strong>where the item ID is not chronological/.test(e);o[i]=t,a(t)})}}()}function o(){l.addAction({name:"Dupe-Check Collection",icon:"fa-check",id:"dupe-check",click:i})}function r(){n(),c.isBackpack()&&o()}var s=e("../script"),c=e("../page"),l=e("../menu-actions");t.exports=r},{"../menu-actions":22,"../page":23,"../script":26}],8:[function(e,t,a){function n(e){var t={},a={};g.addPopovers(e,$(".row:eq(4)"),{next:function(e){function n(t){e({content:t,placement:"right"})}var i=$(this),o=i.closest(".vote"),r=o.find(".vote-stats li:eq(1) a").attr("href");if(t[r])return n(t[r]);a[r]||(a[r]=!0,$.get(r).done(function(e){var a=$($.parseHTML(e)).find(".op .body").html();t[r]=a,n(a)}).always(function(){a[r]=!1}))},delay:0})}function i(){var e=$("#refinedvalue");e.length&&h.shared(function(t){e.tooltip({title:function(){return t.format({value:+e.text().replace(/,/g,""),currency:"metal"},EconCC.Mode.Long)}})})}function o(){function e(e){var t=window.uDetails_createDetails(e),a=e[0].dataset;return"440"===a.app&&"5"===a.quality&&a.effectName&&t.find(".fa-list-alt").parent().after('<a class="btn btn-default btn-xs" href="/unusuals/'+a.name+'"><i class="fa fa-diamond"></i> Unusual</a><a class="btn btn-default btn-xs" href="/effects/'+a.effectName+'"><i class="fa fa-paper-plane-o"></i> Effect</a>'),t}f.exec("var uDetails_createDetails = window.createDetails;window.createDetails = "+e+";")}function r(){function e(e){var t=e.data("converted-from")?e.data("converted-from"):e.data("name"),a="/"+e.data("q-name")+"/"+encodeURIComponent(t)+"/"+(1==e.data("tradable")?"Tradable":"Non-Tradable")+"/"+(1==e.data("craftable")?"Craftable":"Non-Craftable");return e.data("priceindex")&&0!==e.data("priceindex")&&(a+="/"+e.data("priceindex")),window.price_cache[a]={},window.tpp_createDetails(e)}p.pref("other","thirdpartyprices")||f.exec("var tpp_createDetails = window.createDetails;window.createDetails = "+e+";")}function s(){var e=$('.navbar-profile-nav .dropdown-menu a[href^="/u/"]'),t=$('.dropdown a[href="/notifications"]'),a=$(".text-more");("/"===location.pathname||p.pref("homebg","replacewalls")&&/\/img\/bricks_/.test(getComputedStyle(document.body)["background-image"]))&&l(),e.length&&e.parent().after('<li><a href="/settings##bes"><i class="fa fa-fw fa-cog"></i> My Preferences</a></li>'),t.length&&t.parent().before('<li><a href="/lotto"><i class="fa fa-fw fa-money"></i> Lotto</a></li>'),a.length&&n(a),$(".navbar-game-select li a").each(function(){var e=+this.href.replace(/\D/g,""),t="";570===e?t+="dota2.":730===e&&(t+="csgo."),this.href="http://"+t+"backpack.tf"+location.pathname,this.target="_blank"}),p.pref("other","originalkeys")&&$("[data-converted-from]").each(function(){var e=$(this),t=e.find(".output");e.find(".item-icon").css("background-image",t.css("background-image")),t.remove()}),g.isBackpack()&&i(),o(),r()}function c(e,t){var a=new m("bes-cache-wallpaper",0);a.get("url").value!==e?f.GET(e,function(n){var i=n.replace(/\r/g,"").split("\n");a.set("url",e).set("wallpapers",i).save(),t(i)}):t(a.get("wallpapers").value)}function l(){function e(e){return"background: url("+e+"); background-repeat: "+t.repeat+"; background-position: "+t.posx+" "+t.posy+"; background-attachment: "+t.attachment+"; background-size: "+t.sizing+";"}var t=p.prefs.features.homebg,a=t.image.trim();a&&(a.match(/pastebin\.com\/raw.php\?i=/)?c(a,function(t){var a=t[Math.floor(Math.random()*t.length)].trim();a&&(document.body.style.cssText=e(a))}):document.body.style.cssText=e(a))}function u(){function e(){r||($.get("/notifications"),r=!0)}var t,a=p.pref("lotto","show"),n=p.pref("notifications","updatecount"),i=$(".notification-list"),o=$(".md-notification-alert"),r=!1;a||(f.exec("updateLotto = $.noop;"),$(".lotto-box").remove()),i.length&&"no"!==n?(t=i.find(".notification.new"),("load"===n&&t.length||"listing"===n&&t.find(".subject a:contains([removed listing])").length)&&(t.removeClass(".new"),$("#notifications_new").remove(),e()),"click"!==n&&"listing"!==n||i.find(".notification").click(e).attr("target","_blank")):o.length&&"load"===n&&e(),o.length&&o[0].setAttribute("target","_blank")}function d(){s(),"/"===location.pathname&&u()}var p=e("../preferences"),f=e("../script"),h=e("../pricing"),m=e("../cache"),g=e("../page");t.exports=d},{"../cache":3,"../page":23,"../preferences":24,"../pricing":25,"../script":26}],9:[function(e,t,a){function n(){$("#settings-tabs").append('<li><a href="#bes">Enhancement Suite</a></li>'),$('#settings-tabs [href="#bes"]').click(function(e){e.preventDefault(),$(this).tab("show")})}function i(){function e(e,t){return["<section>","<h4>"+e+"</h4>",t.join(""),"</section>"].join("")}function t(e,t,a,n){return['<div class="form-group">',"<label>"+e+"</label>",'<div class="btn-group" data-toggle="buttons" data-component="'+t+'" data-key="'+a+'">',n,"</div>","</div>"].join("")}function a(e,t,a){return['<div class="form-group">','<a class="btn btn-primary"'+(t?' id="'+t+'"':"")+">"+e+"</a>",a||"","</div>"].join("")}function n(e,t,a,n,i){return['<div class="form-group">',"<label>"+e+"</label>",'<input type="text" class="form-control active" value="'+h.escapeHtml(n||"")+'" placeholder="'+h.escapeHtml(i||"")+'" data-component="'+t+'" data-key="'+a+'">',"</div>"].join("")}function i(e,t){return t=t||["Yes","No"],['<label class="btn btn-primary'+(e?" active":"")+'"><input type="radio" value="true"'+(e?" checked":"")+">"+t[0]+"</label>",'<label class="btn btn-primary'+(e?"":" active")+'"><input type="radio" value="false"'+(e?"":" checked")+">"+t[1]+"</label>"].join("")}function l(e,a,n){return t(e,a,n,i(f.pref(a,n)))}function u(e,t,a,i){return n(e,t,a,f.pref(t,a),i)}function d(e,a,n,i){return t(e,a,n,p(i,f.pref(a,n)))}function p(e,t){var a="";return e.forEach(function(e){a+='<label class="btn btn-primary'+(e.value===t?" active":"")+'"><input type="radio" value="'+e.value+'"'+(e.value===t?" checked":"")+">"+e.label+"</label>"}),a}function g(e){return'<span class="help-block">'+e+"</span>"}var v=['<div class="tab-pane" id="bes">','<h3>backpack.tf Enhancement Suite <span class="text-muted">v'+h.SUITE_VERSION+"</span></h3>",'<div class="padded">',d("Notifications widget","notifications","updatecount",[{value:"no",label:"No"},{value:"click",label:"Notification click"},{value:"listing",label:"Removed listing"},{value:"load",label:"Always"}]),g("Requires you to have donated and disabled ads in favor of the notifications widget (Awesome perks tab). This setting applies only to the notifications widget which is on the site index page. Updates the notifications count badge when a notification is clicked, when you have a [removed listing] notification, or always."),e("Classifieds",[u("Sell order signature","classifieds","signature"),g("Message automatically inserted in the 'Message' field of Classified sell order listings you create manually."),u("Buy order signature","classifieds","signature-buy",f.pref("classifieds","signature-buy")),g("Message automatically inserted in the 'Message' field of Classified buy order listings you create manually."),l("Auto-close when listed successfully","classifieds","autoclose"),g("Automatically close the page when you successfully post a Classifieds listing manually."),d("Auto-fill price","classifieds","autofill",[{value:"backpack",label:"backpack.tf"},{value:"lowestauto",label:"Lowest automatic listing"},{value:"lowest",label:"Lowest listing"},{value:"default",label:"Disabled"}]),g("Price to be used for new sell listings. Pricing and pricetag options (range, modifications) will be used to determine the backpack.tf price. The lowest listing is determined whenever peek is used (recommended to enable autopeek below). For those options, if there are no (automatic) listings, nothing will be done."),l("Auto-peek","classifieds","autopeek"),a("Modify Quicklisting Presets","modify-quicklists")]),e("Pricing",[g("These options are used by Pricetags and Recent price changes in backpacks."),d("Price range","pricing","range",[{value:EconCC.Range.Low,label:"Low-end"},{value:EconCC.Range.Mid,label:"Mid (avg)"},{value:EconCC.Range.High,label:"High-end"}]),g("Price range to be used."),d("Currency step","pricing","step",[{value:EconCC.Enabled,label:"Enabled"},{value:EconCC.Disabled,label:"Disabled"}]),g("Whether currency values should be 'prettified'. Metal is rounded to the nearest weapon (except when the value is less than one), and keys are rounded to the nearest 20th. (1.40 ref -> 1.38, 2.27 keys -> 2.25 keys)")]),e("Pricetags",[g("This section requires your 'Item pricetags' (Team Fortress 2 tab) to be 'Game currency'. Only Team Fortress 2 is supported obviously."),d("Value item modifications at","pricetags","modmult",[{value:0,label:"0%"},{value:.05,label:"5%"},{value:.1,label:"10%"},{value:.2,label:"20%"},{value:.25,label:"25%"},{value:.3,label:"30%"},{value:.4,label:"40%"},{value:.5,label:"50%"}]),g("Strange Parts, Paint."),l("Tooltips","pricetags","tooltips"),g("Adds tooltips to items that are priced in keys.")]),e("Recent price changes in backpacks",[l("Enabled","changes","enabled"),g("Shows recent price changes on backpack pages you visit."),d("Price change period","changes","period",[{value:288e5,label:"8 hours"},{value:864e5,label:"1 day"},{value:2592e5,label:"3 days"},{value:432e6,label:"5 days"},{value:6048e5,label:"1 week"}]),l("Outdated unusual warnings","changes","outdatedwarn"),g("Shows an warning icon on outdated unusuals (ones that were updated more than 3 months ago.) Price changes must be enabled for this feature.")]),e("Custom homepage background",[u("Background image url","homebg","image"),g("Leave blank to disable this feature. You can also link to a raw pastebin so an image can be chosen at random <a href='http://pastebin.com/raw.php?i=8CVW6S2z'>(example)</a>. Separate image urls with a newline. Images will share the same options so pick similar ones."),d("Background repeat","homebg","repeat",[{value:"no-repeat",label:"Don't repeat"},{value:"repeat",label:"Tiled"},{value:"repeat-x",label:"Repeat horizontally"},{value:"repeat-y",label:"Repeat veritcally"}]),d("Background veritcal position","homebg","posy",[{value:"top",label:"Top"},{value:"center",label:"Center"},{value:"bottom",label:"Bottom"}]),d("Background horizontal position","homebg","posx",[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"}]),d("Background attachment","homebg","attachment",[{value:"scroll",label:"Scroll with page"},{value:"fixed",label:"Fixed"}]),d("Background sizing","homebg","sizing",[{value:"none",label:"None"},{value:"cover",label:"Fill"},{value:"contain",label:"Contain"}]),l("Replace all walls","homebg","replacewalls"),g("Replaces the default wall image with your background image url.")]),e("Other",[g("Preferences that don't deserve their own section."),l("Show lotto","lotto","show"),g("Shows or hides the lotto on the main page. It can still be viewed at <a href='/lotto'>backpack.tf/lotto</a>."),l("Use original key icons","other","originalkeys"),g("Shows the original key's icon (for converted event keys) full size."),l("Show third party pricing on items","other","thirdpartyprices"),g("Whether third party pricing (trade.tf & tf2wh) should be shown on items. This is a website feature but can be disabled here for a performance improvement, as hovering over any item (even before it shows a popover) issues a request to the backpack.tf web servers.")]),e("Advanced",[a("Import preferences","import-prefs"),a("Export preferences","export-prefs"),g("Import or export your preferences for use on other computers, browsers, etc."),a("Reset preferences","reset-prefs"),g("Resets your preferences (including quicklists) to the default and reloades the page."),a("Clear cache","clear-cache"),g("Clears all caches. Use this if you are advised to. Clicking this button will reload the page and all your unsaved changes will be lost.")]),"</div>","</div>"].join("");$("#settings-panes .tab-content").append(v),$("#modify-quicklists").click(m.modifyQuicklists),$("#clear-cache").click(o),$("#reset-prefs").click(r),$("#import-prefs").click(s),$("#export-prefs").click(c),$("#bes").on("click.bs.button.data-api",'[data-toggle^="button"]',function(e){var t=$(e.target);t.hasClass("btn")||(t=t.closest(".btn")),$.fn.button.call(t,"toggle"),$(e.target).is('input[type="radio"]')||$(e.target).is('input[type="checkbox"]')||e.preventDefault()})}function o(){b.names.forEach(function(e){g.removeItem(e)}),v.keys.forEach(function(e){g.removeItem(e.field)}),location.reload()}function r(){g.removeItem("bes-preferences"),g.removeItem("bes-quicklists"),location.reload()}function s(){h.modal("Import preferences",'<p>Import your backpack.tf Enhancement Suite settings here. Only the format from the export dialog will work.</p><div class="row"><textarea id="import-prefs-json" class="form-control" style="height:170px;resize:vertical"></textarea></div>','<a class="btn btn-primary" id="import-prefs-btn">Import</a>'),$("#import-prefs-btn").click(function(){var e=$("#import-prefs-json").val();h.hideModal();try{f.saveToDS(JSON.parse(e)),location.reload()}catch(e){alert("The preferences you were trying to import are corrupted.")}})}function c(){h.modal("Export preferences",'<p>Store this code to import your preferences elsewhere.</p><div class="row"><textarea id="export-prefs-json" class="form-control" style="height:170px;resize:vertical"></textarea></div>'),$("#export-prefs-json").val(JSON.stringify(f.loadFromDS()))}function l(){location.hash&&$('[href="#'+location.hash.replace(/#/g,"")+'"]').tab("show"),$("#settings-tabs a").click(function(){location.hash="#"+this.href.substr(this.href.indexOf("#"))})}function u(){var e=$("#bes .active"),t={};return e.each(function(){var e,a,n,i,o=$(this);o.data("component")||(o=o.parent()),e=o.data("component"),a=o.data("key"),n=o.hasClass("active")?o.val():o.find(".active [value]").val();try{i=JSON.parse(n)}catch(e){i=n}t[e]=t[e]||{},t[e][a]=i}),t}function d(){var e=$('.panel-body-alt input[type="submit"]');e.click(function(t){t.preventDefault(),e.val("Saving...").addClass("disabled"),f.applyPrefs(u()),$.post("/settings",$("form[action='/settings']").serialize(),function(){e.val("Save Settings").removeClass("disabled")})})}function p(){"/settings"===location.pathname&&(n(),i(),l(),d())}var f=e("../preferences"),h=e("../page"),m=e("./quicklist"),g=e("../datastore"),v=e("../helpers/apikey"),b=e("../cache");t.exports=p},{"../cache":3,"../datastore":19,"../helpers/apikey":20,"../page":23,"../preferences":24,"./quicklist":11}],10:[function(e,t,a){function n(e){var t=e.dataset.paintPrice,a=[e.dataset["part-1Price"],e.dataset["part-2Price"],e.dataset["part-3Price"]],n=0;return t&&(n+=d.fromBackpack(c,t).value),(a[0]||a[1]||a[2])&&a.forEach(function(e){e&&(n+=d.fromBackpack(c,e).value)}),n}function i(e){d.shared(function(t){c=t,e()})}function o(e){var t=u.pref("pricetags","tooltips"),a=u.pref("pricetags","modmult"),i=d.default(),o=!1;[].slice.call(e).forEach(function(e){var r,s=e.dataset,l=s.defindex,u=s.listingSteamid,p=0,f={};if((s.pBptf||s.pScmAll)&&!s.vote&&"440"===s.app&&"5002"!==l&&"5001"!==l&&"5000"!==l){var h=u?d.fromListing(c,s.listingPrice):d.fromBackpack(c,s.pBptf||s.pScmAll.split(",")[0]),m=h.value,g=h.currency;u||(p=n(e),0!==p&&(m+=p*a),!p&&i||(o=!0,s.price=m)),m=c.convertFromBC(m,g),r={value:m||.001,currency:g},u?f={step:EconCC.Disabled}:c.step===EconCC.Enabled&&(f={currencies:{keys:{round:1}}}),c.scope(f,function(){var a,n=e.querySelector(".tag.bottom-right");!p&&i||(a="5021"===l?c.formatCurrency(r):c.format(r,EconCC.Mode.Label).replace(".00",""),n.innerHTML=(u?'<i class="fa fa-tag"></i> ':"~")+a),t&&"key"===g.substr(0,3)&&(n.setAttribute("title",c.format(r,EconCC.Mode.Long)),n.setAttribute("data-suite-tooltip",""),n.classList.add("pricetags-tooltip"))})}}),o&&l.bp()&&(p.exec('$(".item").removeData("price");'),l.bp().updateValues()),t&&l.addTooltips($(".pricetags-tooltip"))}function r(){return 440===l.appid()&&(.5!==u.pref("pricetags","modmult")||!1!==u.pref("pricetags","tooltips")||!d.default())}function s(){var e;r()&&(e=document.querySelectorAll(".item"),e.length&&i(function(){c.scope({currencies:{metal:{trailing:EconCC.Disabled}}},function(){o(e)})}))}var c,l=e("../page"),u=e("../preferences"),d=e("../pricing"),p=e("../script");t.exports=s,t.exports.setupInst=i,t.exports.applyTagsToItems=o,t.exports.enabled=r},{"../page":23,"../preferences":24,"../pricing":25,"../script":26}],11:[function(e,t,a){function n(){var e=M.getItem("bes-quicklists");e?B=JSON.parse(e):(B=A,M.setItem("bes-quicklists",JSON.stringify(B)))}function i(){$("#show-markdown-modal").before(' <a id="bp-custom-select-ql" class="btn btn-default btn-primary btn-xs disabled" href="##">Quicklist selection</a>')}function o(){$("#bp-custom-select-ql").toggleClass("disabled",!inventory.selectionMode)}function r(){var e=$(this),t=e.data("action");"select"===t?y(B[$(this).data("idx")],$(".ql-button-values")):"listbatch"===t&&(m(b($(".ql-button-values"))),D.hideModal())}function s(){return $("[data-listing_offers_url]").first()}function c(){return $(".item:not(.spacer,.unselected,.ql-cloned):visible").filter(function(){var e=$(this);return e.data("can_sell")&&!e.data("listing_account_id")})}function l(e,t){var a=[],n=O[t?"short":"long"],i=t?"":" ";return e.keys&&a.push(e.keys+i+n.keys[+(1!==e.keys)]),e.metal&&a.push(e.metal+i+n.metal[+(1!==e.metal)]),a.join(", ")}function u(){D.addStyle(".ql-button-value-idx { margin-right: 3px; }")}function d(e,t){return'<a class="btn btn-primary ql-button-value-idx ql-action-button" data-action="select" data-idx="'+t+'" style="margin-right: 3px;">'+l(e,!0)+"</a>"}function p(e,t,a,n){return'<div class="ql-button-values"><div class="row"><div class="col-md-3"><label>Metal</label><input type="text" placeholder="0" class="col-md-3 ql-metal form-control" value="'+e+'"></div><div class="col-md-3"><label>Keys</label><input type="text" placeholder="0" class="col-md-3 ql-keys form-control" value="'+t+'"></div>'+(!1!==n?'<a class="btn btn-primary btn-xs ql-remove-button">Remove</a>':"")+'</div><div class="row"><div class="col-md-12"><label>Message</label><input type="text" class="col-md-3 form-control ql-message" value="'+D.escapeHtml(a)+'"></div></div></div>'}function f(){var e;if(!s().length)return window.alert("Create a regular listing first, so the trade offer url can be copied.");if(e=c(),!e.length)return window.alert("No listable items in this selection.");var t="<p>Select a preset for this batch of items, or enter one manually. Click on the respective button to fill in the values.</p><div id='ql-cloned-batch' class='row'></div><div id='ql-button-listing' class='row'>";B.forEach(function(e,a){t+=d(e,a)}),t+="</div><br>",t+=p("","","","",!1),D.modal("List Items",t,'<a class="btn btn-default btn-primary ql-action-button" data-action="listbatch">List Batch</a>'),$("#ql-cloned-batch").html(e.clone()).find(".item").addClass("ql-cloned"),$("#ql-button-listing .ql-select-msg").last().css("margin-bottom","-8px"),$(".ql-button-value-idx").tooltip({html:!1,title:function(){return B[$(this).data("idx")].message||"(none)"},placement:"top"}),D.addItemPopovers($(".ql-cloned"),$("#ql-cloned-batch"))}function h(){$(document).on("click",".ql-action-button",r),
$("#bp-custom-select-ql").click(function(){inventory.selectionMode&&f()})}function m(e){function t(){i[r]&&g(i[r],e,n,function(){r+=1,t()})}var a=c(),n=s(),i=[],r=0;x(),o(),C(),a.each(function(){var e=$(this);i.push(e.data("id")),e.find(".tag.bottom-right").html('<i class="fa fa-spin fa-spinner"></i>')}),t()}function g(e,t,a,n){var i={details:t.message,offers:+!!a.data("listing_offers_url"),buyout:a.data("listing_buyout"),tradeoffer_url:a.data("listing_offers_url"),"user-id":D.csrfToken(),currencies:{metal:t.metal,keys:t.keys}};$.post("http://backpack.tf/classifieds/sell/"+e,i,function(a){var i=/<div class="alert alert-dismissable alert-success">/.test(a);$('[data-id="'+e+'"]').css("opacity",.6).data("can_sell",0).find(".tag.bottom-right").html(i?'<i class="fa fa-tag"></i> '+l(t,!1):'<i class="fa fa-exclamation-circle" style="color:red"></i>'),n&&n()})}function v(){var e=$(".ql-button-values"),t=[];return e.each(function(){t.push(b($(this)))}),t}function b(e){return{metal:+Math.abs(parseFloat(e.find(".ql-metal").val())).toFixed(2)||0,keys:Math.abs(parseInt(e.find(".ql-keys").val(),10))||0,message:e.find(".ql-message").val()||""}}function y(e,t){var a;for(a in e)e.hasOwnProperty(a)&&t.find(".ql-"+a).val(e[a]||("message"===a?"":"0"))}function k(){inventory.selectionMode=!1,ITEM_POPOVERS_DISABLED=!1}function w(){var e,t=0,a=0,n=0,i=0,o=0;e=inventory.selectionMode?$(".item:not(.spacer,.unselected):visible"):$(".item:not(.spacer):visible"),e.each(function(){if(o++,n+=parseFloat($(this).data("price")),$(this).data("market-p")&&-1!=$(this).data("market-p")&&(i+=$(this).data("market-p")),440==$(this).data("app"))switch($(this).data("defindex")){case 5e3:a+=.111111;break;case 5001:a+=.333333;break;case 5002:a++}$(this).data("is-key")&&t++}),a%1>=.9&&(a=Math.round(a)),$("#keycount").html(t.format()),$("#metalcount").html((Math.floor(100*a)/100).toFixed(2)),$("#refinedvalue").html(Math.round(n).format()),$("#dollarvalue").html(Math.round(n*rawValue).format()),$("#marketvalue").html(Math.round(i/100).format()),$("#totalitems").html(o.format())}function x(){inventory.selectionMode&&(D.selectItem($(".item")),k(),w(),C())}function C(){inventory.selectionMode?$("#clear-selection").removeClass("disabled"):$("#clear-selection").addClass("disabled")}function q(){var e="<p>Add, edit, and remove quicklist presets here. Metal can have two decimals, keys must be integers (no decimals). If any value is missing, it is defaulted to 0, with the exception of the message, which then is empty.</p><div id='ql-button-listing'>";B.forEach(function(t){e+=p(t.metal,t.keys,t.message)}),e+='</div><a class="btn btn-default ql-add-button">Add</a>',D.modal("Modify Quicklist Presets",e,'<a class="btn btn-default btn-primary ql-save-button">Save</a>'),$(".ql-save-button").click(function(){B=v().filter(function(e){return(e.metal||e.keys)&&isFinite(e.metal)&&isFinite(e.keys)}),M.setItem("bes-quicklists",JSON.stringify(B)),D.hideModal()}),$(".ql-add-button").click(function(){$("#ql-button-listing").append(p("","","",""))}),$("#ql-button-listing").on("click",".ql-remove-button",function(){$(this).parent().remove()})}function I(){function e(e){inventory.selectionMode=!0,D.selectItem(e),C(),w(),o()}inventory;$("#backpack").on("click",".select-page",function(){var t=$(this).closest(".backpack-page").find(".item").not(".spacer").filter(":visible");if(t.length)if(inventory.selectionMode)if(t.length===t.not(".unselected").length){if(D.unselectItem(t),0===$(".item:not(.unselected)").length)return x(),o(),void w()}else e(t);else D.unselectItem($(".item")),e(t)})}function _(){$(".page-number").each(function(){var e,t=$(this),a=t.find(".page-anchor");a[0]&&(e=t.find(".select-page"),e.length||t.nextUntil(".page-number").not(".spacer").filter(":visible").length&&a.after('<span class="btn btn-primary btn-xs pull-right select-page" style="margin-right: 2.7%;margin-top: -0.1%;">Select Page</span>'))})}function E(){$("#clear-selection").click(function(){$(this).hasClass("disabled")||o()}),P.exec("var old_updateDisplay = window.backpack.updateDisplay;"+_+"window.backpack.updateDisplay = function () { old_updateDisplay.call(window.backpack); addSelectPageButtons(); }")}function S(){var e,t,a=$(".item:not(.spacer)");inventory;P.exec("$('.item:not(.spacer)').off('click');"),a.click(function(n){var i,r=$(this);if(o(),inventory.selectionMode)r.hasClass("unselected")?n.shiftKey&&e&&e.not(".unselected")&&-1!==(i=a.index(e))?(n.preventDefault(),document.getSelection().removeAllRanges(),t=i>a.index(r)?e.prevUntil(r):e.nextUntil(r),e=r,D.selectItem(t.add(r))):(e=r,D.selectItem(r)):(e=null,D.unselectItem(r),0===$(".item:not(.unselected)").length&&(inventory.selectionMode=!1,D.selectItem($(".item")),C(),w()));else{if(e=null,0===r.siblings(".popover").length)return;inventory.selectionMode=!0,D.unselectItem($(".item")),D.selectItem(r),e=r,C()}$("#clear-selection").click(function(){$(this).hasClass("disabled")||k()}),w()})}function T(){u(),n(),D.isBackpack()&&(E(),I(),_(),S()),D.isUserBackpack()&&440===D.appid()&&(i(),h())}var B,D=e("../page"),P=e("../script"),M=e("../datastore"),O={long:{keys:["key","keys"],metal:["ref","ref"]},short:{keys:["k","k"],metal:["r","r"]}},A=[{metal:.05,keys:0,message:""},{metal:.11,keys:0,message:""},{metal:0,keys:1,message:""}];t.exports=T,t.exports.modifyQuicklists=q},{"../datastore":19,"../page":23,"../script":26}],12:[function(e,t,a){function n(){$(".media.listing").filter(":has(.listing-intent-sell)").find(".listing-report").each(function(){$(this).parent().prepend('<a class="btn btn-xs btn-bottom btn-primary listing-refreshbp" data-tip="top" title="" data-original-title="Refresh this user\'s backpack."><i class="fa fa-sw fa-refresh"></i></a>')}),f=!!$(".listing-refreshbp").length}function i(){function e(){offerLinks=jQuery('a[href^="https://steamcommunity.com/tradeoffer/new/"]'),jQuery.merge(offerLinks,jQuery('a[href^="/user/mybot/trades/"][href$="/offer"]'));for(var e=0;e<offerLinks.length;e++){var n=jQuery(offerLinks[e]),i=n.attr("href");"escrow"!==a[i]?"ok"!==a[i]&&"pending"!==a[i]&&(a[i]="pending",t(i)):(n.css("background-color","#C84B43"),n.css("border-color","#C84B43"),n.css("background-image","none"))}}function t(e,n){var i=n||e;GM_xmlhttpRequest({method:"GET",url:i,onload:function(n){var i=n.responseText.match(/window\.location\.href = "(https:\/\/steamcommunity\.com\/tradeoffer\/new\/[^"]+)";/);if(i&&2===i.length)return void t(e,i[1]);-1!==n.responseText.indexOf("var g_daysTheirEscrow = ")&&-1===n.responseText.indexOf("var g_daysTheirEscrow = 0")?a[e]="escrow":a[e]="ok"}})}var a={};"steamcommunity.com"===document.location.host?0!==unsafeWindow.g_daysTheirEscrow&&jQuery(".responsive_page_template_content").css("background-color","darkred"):window.setInterval(e,500)}function o(){m.exec("$('.listing-refreshbp').tooltip({placement: get_tooltip_placement, animation: false});")}function r(e,t){g[e]?t():(g.push(e),$.get("http://backpack.tf/profiles/"+e,t))}function s(e){var t=e.closest(".media.listing").find(".media-object").find("li").data("listing_account_id");return Math.abs(t+76561197960265730)}function c(){$(".listing-buttons").on("click",".listing-refreshbp",function(){var e=$(this);r(s(e),function(){e.fadeOut()})})}function l(e){var t=[],a=0;e&&e.preventDefault(),$(".listing-refreshbp").each(function(){var e=$(this);t.push([s(e),e])}),function e(){t[a]?r(t[a][0],function(){t[a][1].fadeOut(),a+=1,e()}):location.reload()}()}function u(){h.addAction({name:"Refresh All",icon:"fa-refresh",id:"refresh-all",click:l})}function d(){var e=$('<span class="pull-right"><small><a href="#" id="header-refresh-all" style="color: #fff";">Refresh All</a></small></span>');e.find("#header-refresh-all").click(l),$(".panel-heading:contains(Sell Orders)").append(e)}function p(){n(),i(),f&&(o(),c(),"/classifieds"!==location.pathname&&"/classifieds/"!==location.pathname||d(),u())}var f,h=e("../menu-actions"),m=e("../script"),g=[];t.exports=p},{"../menu-actions":22,"../script":26}],13:[function(e,t,a){function n(){function e(e){var t=window.rep_gmp(e);return t.find(".stm-tf2outpost").parent().html('<i class="stm stm-tf2outpost"></i> Outpost'),t.find(".stm-bazaar-tf").parent().html('<i class="stm stm-bazaar-tf"></i> Bazaar'),t.find(".mini-profile-third-party").append(' <a class="btn btn-default btn-xs" target="_blank" href="https://rep.tf/'+e.attr("data-id")+'"><i class="fa fa-check-square"></i> RepTF</a>'),t}m.exec("var rep_gmp = generateMiniProfile;window.generateMiniProfile = "+e)}function i(){if(b.length){var e="<b style='color:red'>User is banned on</b> ⋅ <a href='https://rep.tf/"+f+"' target='_blank'>rep.tf</a><br><br><ul>";b.forEach(function(t){e+="<li><b>"+t.name+"</b> - "+t.reason+"</li>"}),e+="</ul>",v.modal("Community bans",e)}}function o(){$(".btn > .stm-tf2outpost").parent().after(' <a class="btn btn-primary btn-xs" href="https://rep.tf/'+f+'" target="_blank"><i class="fa fa-check-square"></i> rep.tf</a>'),$("small:contains(Community)").html('Community <a id="showrep" style="font-size: 14px; cursor: pointer;">+</a>'),$("#showrep").click(function(){var e="+"===this.textContent;e&&!y&&(i(),y=!0),this.textContent=e?"-":"+",$(".rep-entry").toggle(e)})}function r(){function e(e){var a=e.replace(/\.|-/g,"").toLowerCase();t.push("<li id='"+a+"ban' class='rep-entry' style='display: none'><small>"+e+"</small><span class='label pull-right label-default rep-tooltip' data-placement='bottom'><i class='fa fa-spin fa-spinner'></i></span></li>")}var t=[];e("Outpost"),e("Bazaar"),$(".community-statii .stats li").last().after($(t.join("")))}function s(){var e;h=new g("bes-cache-reptf",k),e=h.get(f),e.update?l():d(e.value)}function c(e){var t={success:e.success};return w.forEach(function(a){e[a]&&(t[a]={banned:e[a].banned,message:e[a].message})}),t}function l(){m.POST("https://rep.tf/api/bans?str="+f,function(e){var t;try{t=c(JSON.parse(e))}catch(e){t={success:!1}}x=t.success,h.set(f,t),t.success&&h.save(),d(t)},{headers:{Referer:"https://rep.tf/"+f,"X-Requested-With":"XMLHttpRequest",Origin:"https://rep.tf"}})}function u(){$(".rep-tooltip").tooltip({html:!0,title:function(){return this.dataset.content}})}function d(e){function t(e,t){var a=e.replace(/\.|-/g,"").toLowerCase(),n=$("#"+a+"ban").find(".rep-tooltip");if(n.removeClass("label-default"),x){if(!t||!t.banned)return n.addClass("label-warning").data("content","Ban status could not be retrieved.").text("ERR");"bad"===t.banned&&b.push({name:e,reason:t.message}),n.addClass("label-"+{good:"success",bad:"danger"}[t.banned]).data("content",t.message).text({good:"OK",bad:"BAN"}[t.banned])}else n.addClass("label-warning").data("content","Ban status could not be retrieved.").text("ERR")}t("SteamRep",e.srBans),t("Outpost",e.opBans),t("Bazaar",e.bzBans),t("Backpack.tf",e.bptfBans),u(),v.$id("showrep").style.color=x?b.length?"#D9534F":"#5CB85C":"#F0AD4E"}function p(){n(),v.isProfile()&&(f=v.profileSteamID(),o(),r(),s())}var f,h,m=e("../script"),g=e("../cache"),v=e("../page"),b=[],y=!1,k=18e5,w=["srBans","bzBans","opBans","stfBans","bptfBans"],x=!0;t.exports=p},{"../cache":3,"../page":23,"../script":26}],14:[function(e,t,a){function n(e){var t=e.split(":"),a=t[0],n=t.splice(1).join(":"),i=p.scopes[a],o=p.cache(e);n&&i&&(o?i.render(o):i.load(e,a,n))}function i(e){return e.split(":").length>=2}function o(){var e=c.window.$("#navbar-search").data("instance"),t=e.showHints;c.exec('$("#navbar-search").off("keyup");'),$("#navbar-search").keyup(function(){var t=$(this).val().trim();e.lastQuery!==t&&(clearTimeout(e.timer),e.timer=setTimeout(function(){i(t)?n(t):e.processSearch()},350),e.lastQuery=t)}),e.showHints=function(){t.call(e),e.$dropdown.find("li:nth(1)").append(p.hints.join(""))},e.showHints()}function r(){p.include(e("./searchscopes/scm")),p.include(e("./searchscopes/unusuals")),p.include(e("./searchscopes/classifieds"))}function s(){r(),o()}var c=e("../script"),l={440:{qualities:{Normal:["#B2B2B2","#858585"],Genuine:["#4D7455","#204728"],Vintage:["#476291","#1a3564"],Unusual:["#8650AC","#59237f"],Unique:["#FFD700","#d2aa00"],Community:["#70B04A","#43831D"],"Self-Made":["#70B04A","43831D"],Strange:["#CF6A32","#a23d05"],Haunted:["#38F3AB","#0bc67e"],"Collector's":["#830000","#560000"]},qids:{normal:0,genuine:1,rarity2:2,vintage:3,rarity3:4,unusual:5,unique:6,community:7,valve:8,"self-made":9,customized:10,strange:11,completed:12,haunted:13,"collector's":14,"decorated weapon":15},defquality:"Unique"},570:{qualities:{Base:["#B2B2B2","#858585"],Genuine:["#4D7455","#204728"],Elder:["#476291","#1a3564"],Unusual:["#8650AC","#59237f"],"Self-Made":["#70B04A","#43831D"],Inscribed:["#CF6A32","#a23d05"],Cursed:["#8650AC","#59237f"],Heroic:["#8650AC","#59237f"],Favored:["#FFFF00","#D2D22D"],Ascendant:["#EB4B4B","#BE1E1E"],Autographed:["#ADE55C","#80B82F"],Legacy:["#FFFFFF","#D2D2D2"],Exalted:["#CCCCCC","#9F9F9F"],Frozen:["#4682B4","#195587"],Corrupted:["#A52A2A","#780303"],Auspicious:["#32CD32","#50A050"]},defquality:"Base"},730:{qualities:{Normal:["#B2B2B2","#858585"],"StatTrak™":["#CF6A32","#a23d05"],Souvenir:["#FFD700","#d2aa00"],"★":["#8650AC","#59237f"],Prototype:["#70B04A","#43831D"]},defquality:"Normal"}},u={"Team Fortress 2":440,"Counter-Strike: Global Offensive":730,"Dota 2":570},d={};d.tf=d.tf2=440,d.cs=d.csgo=d.go=730,d.dota=d.dota2=d.dt=d.dt2=570,d.steam=d.stm=753,d.scm=d.market=1;var p={_req:null,_reqcache:{},scopes:{},apps:{ids:d,qualities:l,names:u},hints:[],request:function(e,t){this._req&&this._req.abort(),"function"==typeof t&&(e.onload=function(a){e.query&&p.cache(e.query,a.responseText),t(a.responseText)}),this._req=c.xhr(e)},cache:function(e,t){var a=this._reqcache;return 1===arguments.length?a[e]:this._reqcache.hasOwnProperty(e)?a[e]:(a[e]=t,void setTimeout(function(){delete a[e]},3e5))},register:function(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){p.scopes[e]=t})},hint:function(e,t){this.hints.push('<p class="hint-title">'+e+'</p><p class="hint">'+t+"</p>")},include:function(e){e.register(p)}};t.exports=s},{"../script":26,"./searchscopes/classifieds":15,"./searchscopes/scm":16,"./searchscopes/unusuals":17}],15:[function(e,t,a){function n(e){var t=e.split(","),a=t[0],n=(t[1]||"").split("+"),i=["item="+a];return n[0]&&i.push("quality="+(isNaN(parseInt(n[0],10))?s.apps.qualities[440].qids[n[0].toLowerCase()]||6:n[0])),n[1]&&"australium"===n[1].toLowerCase()&&i.push("australium=1"),"+"===t[2]?i.push("tradable=1"):"-"===t[2]&&i.push("tradable=0"),"+"===t[3]?i.push("craftable=1"):"-"===t[3]&&i.push("craftable=0"),i.join("&")}function i(e,t,a){s.request({url:"https://backpack.tf/classifieds?"+n(a),method:"GET",query:e},function(e){l.shared(function(t){c=t,c.scope({step:EconCC.Disabled},function(){r(e)})})})}function o(e){return $($.parseHTML(e)).find(".item").map(function(){var e=this.querySelector(".item-icon").style.backgroundImage;return this.dataset.imgurl=e.substring(e.indexOf("(")+1,e.indexOf(")")),this.dataset.title=this.getAttribute("title"),JSON.parse(JSON.stringify(this.dataset))}).toArray()}function r(e){var t,a,n,i,r,d=$(".site-search-dropdown"),p="",f={};if(d.empty(),e){o(e).forEach(function(e){var t=s.apps.qualities[440].qualities[e.qName],a="border-color:"+t[1]+";background-color:"+t[0],n=("1"===e.craftable?"":" nocraft")+("1"===e.tradable?"":" notrade"),i=f[e.title],o=l.fromListing(c,e.listingPrice),r=o.value+";"+o.currency;"1"===e.listingIntent&&(i||(i=f[e.title]={prices:{},url:e.listingUrl,states:n,colors:a,img:e.imgurl}),i.prices[r]=(i.prices[r]||0)+1)});for(t in f){a=f[t],p+='<li class="mini-price"><div class="item-mini"><img src="'+a.img+'"></div><div class="item-name">'+t+'</div><div class="buttons">';for(n in a.prices)i=n.split(";"),r={value:c.convertFromBC(+i[0],i[1]),currency:i[1]},p+='<a href="'+a.url+'" class="btn btn-xs classifieds-search-tooltip'+a.states+'" style="'+a.colors+'" title="'+c.format(r,EconCC.Mode.Long)+'">'+a.prices[n]+"× "+c.format(r,EconCC.Mode.Label)+"</a>";p+="</div></li>"}d.append(p),u.addTooltips($(".classifieds-search-tooltip"),".site-search-dropdown")}else d.append('<li class="header">No matches</li>')}var s,c,l=e("../../pricing"),u=e("../../page");a.register=function(e){s=e,e.register(["classifieds","classified","cl","c"],{load:i,render:r}),e.hint("Classifieds sell orders","Type c: followed by the name of the item. For fine-grained searches, use the item name,quality,tradable,craftable format like Warmer,unique,+,-")}},{"../../page":23,"../../pricing":25}],16:[function(e,t,a){function n(e,t,a){var n=c.apps.ids[t];n&&c.request({query:e,url:s(n,a),method:"GET"},i)}function i(e){var t,a=JSON.parse(e),n=[];if(!a.total_count)return r(!1);t=$($.parseHTML(a.results_html)),t.filter(".market_listing_row_link").each(function(){var e=$(this);n.push({img:e.find(".market_listing_item_img").attr("src"),price:e.find(".market_table_value span:last").text(),qty:e.find(".market_listing_num_listings_qty").text(),name:e.find(".market_listing_item_name").text(),url:this.href,description:e.find(".market_listing_game_name").text()})}),u?r(n):d.shared(function(e){l=e,p.init(function(e){u=e,r(n)})})}function o(e,t){var a,n,i,o,r=c.apps.qualities[t];if(!t||!r)return{name:e};for(o in r.qualities)if(i=new RegExp("^"+o+" "),i.test(e)){a=r.qualities[o],n=o,e=e.replace(i,"");break}return a||(a=r.qualities[r.defquality],n=r.defquality),Array.isArray(a)||(a=[a,a]),{name:e,style:"background-color:"+a[0]+";border-color:"+a[1]+";",qualityName:n}}function r(e){function t(e){p+="<li>"+e.html()+"</li>"}var a,n,i,r,s,d=$(".site-search-dropdown"),p="",h={},m={};if(d.empty(),!e)return d.html('<li class="header">No results found.</li>');for(i=0;i<e.length;i+=1)if(n=e[i],"0"!==n.qty){var g=$('<li class="mini-suggestion">'),v=$('<div class="buttons">'),b=n.description,y=c.apps.names[b],k=o(n.name,y),w=k.name,x=u.parse(n.price);if(!x.matched)return void d.append('<li class="header">Steam wallet currency unsupported</li>').append('<li><p class="hint">Your Steam wallet currency is not supported by this feature.</p></li>');"USD"!==x.alpha&&(r=u.convert(l.currencies.usd.low,"USD",x.alpha),l.currencies.usd.high&&(s=u.convert(l.currencies.usd.high,"USD",x.alpha)),m={currencies:{usd:{symbol:x.sym,low:r,high:s,pos:{sym:x.trailing?"end":"start"}},metal:{low:r,high:s}}}),l.scope(m,function(){v.append('<a class="btn btn-default btn-xs scm-search-tooltip" href="'+n.url+'" title="'+l.format(l.scm(l.parse(x.val+" usd")).seller,EconCC.Mode.Long)+'">'+n.price+"</a>").append('<a class="btn btn-default disabled btn-xs">'+n.qty+" listed</a>")}),g.append("<div class='item-mini scm-search-tooltip'"+(k.style?" style='"+k.style+"' title='"+k.qualityName+"'":"")+"><img src='"+n.img+"'></div>").append("<div class='item-name'>"+w+"</div>").append(v),h[b]=h[b]||[],h[b].push(g)}for(a in h)p+="<li class='header'>"+a+"</li>",h[a].forEach(t);d.html(p),f.addTooltips($(".scm-search-tooltip"),".site-search-dropdown")}function s(e,t){return"http://steamcommunity.com/market/search/render/?query="+encodeURIComponent(t)+(1===e?"":"&appid="+e)+"&currency=1&start=0&count=6"}var c,l,u,d=e("../../pricing"),p=e("../cc"),f=e("../../page");a.register=function(e){var t,a=[];c=e;for(t in c.apps.ids)a.push(t);e.register(a,{load:n,render:i}),e.hint("SCM Item Prices","Type scm:, tf:, cs:, or dt: followed by the name of the item.")}},{"../../page":23,"../../pricing":25,"../cc":4}],17:[function(e,t,a){function n(e,t,a){if(s)return o(s,a);r.request({url:"https://backpack.tf/unusuals",method:"GET"},function(e){o(s=i(e),a)})}function i(e){return $($.parseHTML(e)).find(".item").map(function(){var e=this.querySelector(".item-icon").style.backgroundImage;return this.dataset.imgurl=e.substring(e.indexOf("(")+1,e.indexOf(")")),this.dataset.avg=this.querySelector(".tag.bottom-right").innerText,JSON.parse(JSON.stringify(this.dataset))}).toArray()}function o(e,t){var a,n,i=$(".site-search-dropdown"),o=new RegExp(t,"i"),s="",c=[];for(i.empty(),n=0;n<e.length&&(a=e[n],!o.test(a.name)||(c.push(a),10!==c.length));n+=1);if(!c.length)return i.append('<li class="header">No matches</li>');c.sort(function(e,t){return+t.price-+e.price}).forEach(function(e){var t=r.apps.qualities[440].qualities[e.qName],a="border-color:"+t[1]+";background-color:"+t[0];s+='<li class="mini-price"><div class="item-mini"><img src="'+e.imgurl+'"></div><div class="item-name">'+e.name+'</div><div class="buttons"><a href="/unusuals/'+e.name+'" class="btn btn-xs" style="'+a+'">'+e.avg+'</a><a href="'+e.listingUrl+'" class="btn btn-xs" style="'+a+'">Classifieds</a></div></li>'}),i.append(s)}var r,s;a.register=function(e){r=e,e.register(["unusuals","unusual","u"],{load:n,render:o}),e.hint("Unusual price indices","Type u: followed by the name of the item.")}},{}],18:[function(e,t,a){function n(e,t,a){var n={img:"url(https://steamcdn-a.akamaihd.net/apps/440/icons/"+e+".png),url(/images/440/particles/"+t+"_94x94.png)"};return a?"number"==typeof a?n.lmargin=n.rmargin=a:(n.lmargin=a[0],n.rmargin=a[1]):n.lmargin=n.rmargin=-4,n}function i(e){var t="";e.forEach(function(e){var a=f[e];t+='<div data-title="'+a.title+'" data-content="'+a.content+'" class="user-badge bes-badge'+(a.class?" "+a.class:"")+'"'+(a.style?' style="'+a.style+'"':"")+'><i class="fa '+a.icon+'"></i></div>'}),$(".user-badge-list .user-badge:last").after(t)}function o(){$(".user-badge.bes-badge").popover({html:!0,trigger:"hover",placement:"bottom"})}function r(e){$(".user-link").each(function(){var e=this.dataset.id||"",t=m[e.substr(h.length)];t&&(t.color||t.font)&&(this.style.fontWeight="700",this.style.setProperty("color",t.color,"important"),t.font&&this.style.setProperty("font-family",t.font))})}function s(e){$(".user-link").each(function(){var e,t,a,i,o,r=this.dataset.id||"",s=m[r.substr(h.length)];s&&s.icon&&(e=n.apply(null,s.icon),t=this.querySelector(".label-belt"),(t=this.querySelector(".belt"))&&(a=e.padding||14,e.margin&&(i=o=e.margin),e.lmargin&&(i=e.lmargin),e.rmargin&&(o=e.rmargin),t.innerHTML='<span style="background-image:'+e.img+";background-size:contain;background-repeat:no-repeat;padding:"+a+"px;margin-left:"+i+"px;margin-right:"+o+'px;text-shadow:none;color: transparent;">★</span>'))})}function c(){var e,t=l.users();r(t),s(t),l.isProfile()&&(e=m[l.profileSteamID().substr(h.length)])&&e.badges&&(i(e.badges),o())}var l=e("../page"),u={title:"Self-Made User Badge",content:"I made this!",style:"border-color:#3e6527;background-color:#70B04A;box-shadow:inset 0 0 14px #68a046;",icon:"fa-paint-brush"},d={title:"Enhancement Suite Supporter",content:"This caring heart donated to the Enhancement Suite project! Thank you!",class:"gold",icon:"fa-trophy"},p={title:"Collaborator",content:"I helped create Enhancement Suite!",style:"border-color:#ff1ab1;background-color:#ff66cb;box-shadow:inset 0 0 0px #ff1ab1;",icon:"fa-code"},f=[u,d,p],h="7656119",m={8070299574:{badges:[0],color:"#028482"},8039453751:{badges:[1],icon:["soldier_hat.61b68df2672217c4d2a2c98e3ed5e386a389d5cf",14,[-4,-4]],font:["TimesNewRoman, Times New Roman, Times, Baskerville, Georgia, serif"]},8068022595:{badges:[1],color:"#f9d200"},8107654171:{badges:[1],color:"#0b1c37",icon:["xms2013_demo_plaid_hat.152c6db9806406bd10fd82bd518de3c89ccb6fad",58,[-7,-8]]},8067575136:{badges:[1],icon:["xms_pyro_parka.de5a5f80e74f428204a4f4a7d094612173adbe50",13,[-9,-12]]},8044195191:{badges:[1],icon:["fez.ee87ed452e089760f1c9019526d22fcde9ec2450",43,[-2,-4]]},8056198948:{badges:[1],icon:["jul13_soldier_fedora.ec4971943386c378e174786b6302d058e4e8627a",10,[-5,-6]]},8165677507:{badges:[1],color:"#FF6000",icon:["cc_summer2015_potassium_bonnett.3849871e2fe2b96fb41209de62defa59b136f038",38,[-5,-6]]},8067795713:{badges:[1],color:"#000066",icon:["soldier_warpig.e183081f85b5b2e3e9da1217481685613a3fed1f",14,[-10,-11]]},7980709148:{badges:[1],color:"#A41408"},8081201910:{badges:[1],color:"#CC0000",icon:["hat_first_nr.e7cb3f5de1158e924aede8c3eeda31e920315f9a",64,[-10,-11]],font:["Optima, Segoe, Segoe UI, Candara, Calibri, Arial, sans-serif"]},8117484140:{badges:[1],color:"#00BBFF",icon:["medic_ttg_max.5c4b7fcf10ab25fbd166831aea1979395549cb75",13,[-10,-11]]},8005031515:{badges:[1],icon:["demo_hood.2fa33d5d09dcbfed6345cf927db03c10170b341e",29,[-2,-5]]},8076020691:{badges:[1],color:"#a0d126",icon:["witchhat_demo.75012466ebcf4d9d81c6d7f75ca646b673114353",6,[-6,-7]]},8048498731:{badges:[2,0],color:"#9CDF59",icon:["pcg_hat_engineer.13ee1cad574b26c2b7d561a799f8edfaca9ac18c",9,[-5,-6]],font:["Tahoma, Geneva, sans-serif"]},8080179568:{badges:[2],icon:["tooth_hat.c2014cb6315e2ce880058cdcd0a7569056b11260",10,[-5,-6]]}};t.exports=c},{"../page":23}],19:[function(e,t,a){a.setItem=function(e,t){return GM_setValue(e,t)},a.getItem=function(e){var t=localStorage.getItem(e);return t?(GM_setValue(e,t),localStorage.removeItem(e),t):GM_getValue(e)},a.removeItem=function(e){return GM_deleteValue(e)}},{}],20:[function(e,t,a){function n(e,t,a){this.field=e,this.loadconf=t,this.done=a,this.key="",n.keys.push(this)}var i=e("../datastore"),o=e("../script");n.prototype.register=function(){throw new Error("abstract method register not reimplemented")},n.prototype.extract=function(){throw new Error("abstract method extract not reimplemented")},n.prototype.obtain=function(){var e=this;o[this.loadconf.method||"GET"](this.loadconf.url,function(t){var a=e.extract(t);a?(e.set(a),e.ready()):e.register()})},n.prototype.set=function(e){e&&(this.key=e,i.setItem(this.field,e))},n.prototype.remove=function(){this.key="",i.removeItem(this.field)},n.prototype.ready=function(){this.done()},n.prototype.load=function(){var e=i.getItem(this.field);e?(this.key=e,this.ready()):this.obtain()},n.keys=[],t.exports=n},{"../datastore":19,"../script":26}],21:[function(e,t,a){function n(){this.queue=[],this.busy=!1}n.prototype.enqueue=function(){var e=arguments,t=this;this.queue.push(function(){t.exec.apply(t,e)}),this.canProceed()&&!this.busy&&this.next()},n.prototype.next=function(){if(!this.busy){var e=this.queue.shift();e&&(this.busy=!0,e())}},n.prototype.exec=function(){throw new Error("abstract method exec not reimplemented")},n.prototype.canProceed=function(){return!0},n.prototype.done=function(){this.busy=!1,this.next()},t.exports=n},{}],22:[function(e,t,a){var n=e("./page"),i=[];a.addAction=function(e){return i.push(e),n.loaded&&a.applyActions(),this},a.applyActions=function(){if(n.loggedIn()&&i.length){document.getElementById("bp-custom-actions")||$('.navbar-profile-nav .dropdown-menu a[href="/donate"]').parent().find("+ .divider").after('<li class="divider" id="bp-custom-actions"></li>');var e="";i.forEach(function(t){e+='<li><a href="#" id="'+t.id+'"><i class="fa fa-fw '+t.icon+'"></i> '+t.name+"</a></li>"}),$("#bp-custom-actions").before(e),i.forEach(function(e){document.getElementById(e.id).addEventListener("click",function(t){t.preventDefault(),e.click.call(this)},!1)}),i=[]}}},{"./page":23}],23:[function(e,t,a){function n(e,t){a[e]=function(){return r[t]}}function n(e,t){a[e]=function(){return r[t]}}var i=e("./script"),o=/\D/g,r={ownid:"",profile:!1,backpack:!1,ownprofile:!1,ownbackpack:!1,steamid:"",loggedin:!1,token:"",appid:0,indexpage:!1,loaded:!1,handles:{}};a.init=function(){var e=$(".navbar-profile-nav .dropdown-menu");r.steamid=$(".profile .avatar-container a")[0]||"",r.loggedin=e.length,r.steamid&&(r.profile=!0,r.backpack=r.profile&&!!document.getElementById("backpack"),r.steamid=r.steamid.href.replace(o,"")),r.loggedin&&(r.ownid=e.find(".fa-briefcase").parent().attr("href").replace(o,""),r.profile&&(r.ownprofile=r.ownid===r.steamid),r.token=i.window.userID||e.find(".fa-sign-out").parent().attr("href").replace(/(.*?=)/,""),r.ownbackpack=r.ownprofile&&r.backpack),r.indexpage="/"===location.pathname,r.appid=440,-1!==location.hostname.indexOf("dota2")?r.appid=570:-1!==location.hostname.indexOf("csgo")&&(r.appid=730),r.handles=$(".handle")},a.state=r,n("isProfile","profile"),n("isBackpack","backpack"),n("profileSteamID","steamid"),n("loggedIn","loggedin"),n("userSteamID","ownid"),n("isUserProfile","ownprofile"),n("isUserBackpack","ownbackpack"),n("csrfToken","token"),n("appid","appid"),n("isIndexPage","indexpage"),n("ready","loaded"),n("users","handles"),a.escapeHtml=function(e){return $("<span>").text(e).text().replace(/"/g,"&quot;").replace(/'/g,"&apos;")},a.addStyle=function(e){var t=document.createElement("style");t.textContent=e,(document.head||document.body||document.documentElement).appendChild(t)},a.$id=function(e){return document.getElementById(e)},a.SUITE_VERSION=GM_info.script.version,a.addTooltips=function(e,t){e||(e=$("[data-suite-tooltip]")),e.tooltip({container:t||"body"})},a.addPopovers=function(e,t,a){return e.mouseenter(function(){function e(e){var a,n;e=e||{},a="function"==typeof e.content?e.content.call(t):e.content,n="function"==typeof e.placement?e.placement.call(t):e.placement,t.popover({animation:!1,html:!0,trigger:"manual",placement:n,content:a}),setTimeout(function(){t.filter(":hover").length&&($(".popover").remove(),t.popover("show"),t[0].style.padding=0,e.show&&e.show.call(t))},e.delay||0)}var t=$(this);t.parent().hasClass("item-list-links")||(a.next?a.next.call(t,e):e(a))}).mouseleave(function(){var e=$(this);setTimeout(function(){e.filter(":hover").length||$(".popover:hover").length||(e.popover("hide"),a.hide&&a.hide.call(e))},100)}).on("shown.bs.popover",function(){i.exec("$('.popover-timeago').timeago();")}),t&&t.on("mouseleave",".popover",function(){var e=$(this);setTimeout(function(){e.is(":hover")||e.remove()},300)}),e},a.addItemPopovers=function(e,t){a.addPopovers(e,t,{content:function(){return i.window.createDetails(this)},placement:function(){return i.window.get_popover_placement},show:function(){var e=this[0].dataset,t=e.defindex,a=e.quality,n=e.priceindex,i=+!e.craftable,o=e.app;$("#search-bazaar").click(function(){window.searchBazaar(t,a,n,i,o)}),$("#search-outpost").click(function(){window.searchOutpost(t,a,n,i,o)}),$("#search-lounge").click(function(){window.searchLounge(t,a)})}})},a.addItemIcon=function(e,t){var a=$(e),n=a.find(".icon-stack");return n.length||(a.append('<div class="icon-stack"></div>'),n=a.find(".icon-stack")),t?n.append(t):n},a.modal=function(){return i.window.modal.apply(i.window,arguments)},a.hideModal=function(){$("#active-modal, .modal-backdrop").remove()},a.bp=function(){return i.window.backpack},a.selectItem=function(e){e.removeClass("unselected")},a.unselectItem=function(e){e.addClass("unselected")};var i=e("./script"),o=/\D/g,r={ownid:"",profile:!1,backpack:!1,ownprofile:!1,ownbackpack:!1,steamid:"",loggedin:!1,token:"",appid:0,indexpage:!1,loaded:!1,handles:{}};a.init=function(){var e=$(".navbar-profile-nav .dropdown-menu");r.steamid=$(".profile .avatar-container a")[0]||"",r.loggedin=e.length,r.steamid&&(r.profile=!0,r.backpack=r.profile&&!!document.getElementById("backpack"),r.steamid=r.steamid.href.replace(o,"")),r.loggedin&&(r.ownid=e.find(".fa-briefcase").parent().attr("href").replace(o,""),r.profile&&(r.ownprofile=r.ownid===r.steamid),r.token=i.window.userID||e.find(".fa-sign-out").parent().attr("href").replace(/(.*?=)/,""),r.ownbackpack=r.ownprofile&&r.backpack),r.indexpage="/"===location.pathname,r.appid=440,-1!==location.hostname.indexOf("dota2")?r.appid=570:-1!==location.hostname.indexOf("csgo")&&(r.appid=730),r.handles=$(".handle")},a.state=r,n("isProfile","profile"),n("isBackpack","backpack"),n("profileSteamID","steamid"),n("loggedIn","loggedin"),n("userSteamID","ownid"),n("isUserProfile","ownprofile"),n("isUserBackpack","ownbackpack"),n("csrfToken","token"),n("appid","appid"),n("isIndexPage","indexpage"),n("ready","loaded"),n("users","handles"),a.escapeHtml=function(e){return $("<span>").text(e).text().replace(/"/g,"&quot;").replace(/'/g,"&apos;")},a.addStyle=function(e){var t=document.createElement("style");t.textContent=e,(document.head||document.body||document.documentElement).appendChild(t)},a.$id=function(e){return document.getElementById(e)},a.SUITE_VERSION=GM_info.script.version,a.addTooltips=function(e,t){e||(e=$("[data-suite-tooltip]")),e.tooltip({container:t||"body"})},a.addPopovers=function(e,t,a){
return e.mouseenter(function(){function e(e){var a,n;e=e||{},a="function"==typeof e.content?e.content.call(t):e.content,n="function"==typeof e.placement?e.placement.call(t):e.placement,t.popover({animation:!1,html:!0,trigger:"manual",placement:n,content:a}),setTimeout(function(){t.filter(":hover").length&&($(".popover").remove(),t.popover("show"),t[0].style.padding=0,e.show&&e.show.call(t))},e.delay||0)}var t=$(this);t.parent().hasClass("item-list-links")||(a.next?a.next.call(t,e):e(a))}).mouseleave(function(){var e=$(this);setTimeout(function(){e.filter(":hover").length||$(".popover:hover").length||(e.popover("hide"),a.hide&&a.hide.call(e))},100)}).on("shown.bs.popover",function(){i.exec("$('.popover-timeago').timeago();")}),t&&t.on("mouseleave",".popover",function(){var e=$(this);setTimeout(function(){e.is(":hover")||e.remove()},300)}),e},a.addItemPopovers=function(e,t){a.addPopovers(e,t,{content:function(){return i.window.createDetails(this)},placement:function(){return i.window.get_popover_placement},show:function(){var e=this[0].dataset,t=e.defindex,a=e.quality,n=e.priceindex,i=+!e.craftable,o=e.app;$("#search-bazaar").click(function(){window.searchBazaar(t,a,n,i,o)}),$("#search-outpost").click(function(){window.searchOutpost(t,a,n,i,o)}),$("#search-lounge").click(function(){window.searchLounge(t,a)})}})},a.addItemIcon=function(e,t){var a=$(e),n=a.find(".icon-stack");return n.length||(a.append('<div class="icon-stack"></div>'),n=a.find(".icon-stack")),t?n.append(t):n},a.modal=function(){return i.window.modal.apply(i.window,arguments)},a.hideModal=function(){$("#active-modal, .modal-backdrop").remove()},a.bp=function(){return i.window.backpack},a.selectItem=function(e){e.removeClass("unselected")},a.unselectItem=function(e){e.addClass("unselected")}},{"./script":26}],24:[function(e,t,a){function n(){return JSON.parse(d.getItem("bes-preferences")||'{"features": {}}')}function i(e){return d.setItem("bes-preferences",JSON.stringify(e)),a}function o(e){var t=p.features[e];return!!t&&t.enabled}function r(e,t,n){var i=p.features[e];return i||(i=p.features[e]={}),2===arguments.length?i[t]:(i[t]=n,a.dirty=!0,a)}function s(e,t,n){var i=p.features[e];return i||(i=p.features[e]={}),i.hasOwnProperty(t)||(i[t]=n,a.dirty=!0),a}function c(e){var t,n,i,o,r;for(t in e){i=e[t],n=p.features[t],n||(n=p.features[t]={});for(o in i)r=i[o],n.hasOwnProperty(o)||(n[o]=r,a.dirty=!0)}return a}function l(){a.dirty&&d.setItem("bes-preferences",JSON.stringify(p))}function u(e){var t,n,i;for(t in e){i=e[t];for(n in i)a.pref(t,n,i[n])}return a.save(),a}var d=e("./datastore"),p=n();a.dirty=!1,a.prefs=p,a.loadFromDS=n,a.saveToDS=i,a.enabled=o,a.pref=r,a.default=s,a.defaults=c,a.save=l,a.applyPrefs=u},{"./datastore":19}],25:[function(e,t,a){var n,i,o=e("./preferences"),r=e("./api");a.shared=function(e){if(n)return e(n,i);a.ec(function(t,a){n=t,i=a,e(t)})},a.ec=function(e){function t(e){var t=new EconCC(e);return t.step=o.pref("pricing","step"),t.range=o.pref("pricing","range"),delete t.currencies.earbuds,t}if(i)return e(t(i));r.IGetCurrencies(function(a){i||(i=a),e(t(a))})},a.default=function(){return o.pref("pricing","step")===EconCC.Disabled&&o.pref("pricing","range")===EconCC.Range.Mid},a.fromListing=function(e,t){if("string"!=typeof t)return{value:0,currency:null};var a,n=t.split(", "),i=0,o=0;return n.forEach(function(t){var n=t.split(" "),r=+n[0],s=n[1],c=e.convertToBC(r,s);c>o&&(o=c,a=s),i+=c}),{value:i,currency:a}},a.fromBackpack=function(e,t){if("string"!=typeof t)return{value:0,currency:null};var a=e.parse(t);return{value:e.convertToBC(a),currency:a.currency}}},{"./api":2,"./preferences":24}],26:[function(e,t,a){var n=0;a.exec=function(e){return window.eval(e)},a.window=unsafeWindow,a.xhr=GM_xmlhttpRequest,a.VERB=function(e,t,n,i){n.method=i,n.url=e,n.onload=function(e){t(e.responseText)},a.xhr(n)},a.GET=function(e,t,n){a.VERB(e,t,n||{},"GET")},a.POST=function(e,t,n){a.VERB(e,t,n||{},"POST")},a.uniq=function(){return n++}},{}]},{},[1]);